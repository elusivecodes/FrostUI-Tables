!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-Tables requires a Window.");if(!("UI"in t))throw new Error("FrostUI-Tables requires FrostUI.");const e=t.Core,s=t.dom,i=(t.QuerySet,t.UI);t.document;class n extends i.BaseComponent{constructor(t,s){let i;super(t,s),this._data=[],this._getData=null,this._getResults=null,e.isFunction(this._settings.getResults)?(this._getResultsCallbackInit(),this._getResultsInit()):i=e.isArray(this._settings.data)?this._settings.data:this.constructor._getDataFromDOM(this._node),i&&(this._data=i,this._getDataInit()),this._headings=this.constructor._getHeadingsFromDOM(this._node),this._columns=[],this._settings.columns?this._columns=this._settings.columns:this._columns=new Array(this._headings.length).fill(),this._columns=this._columns.map(t=>({key:null,orderData:null,orderable:!0,searchable:!0,...t})),this._offset=0,this._limit=this._settings.length,this._order=this._settings.order.slice(),this._filter=null,this._render(),this._events(),this._getData()}destroy(){super.destroy()}}Object.assign(n.prototype,{_events(){s.addEvent(this._lengthSelect,"change",t=>{const e=s.getValue(t.currentTarget);this._limit=e,this._getData()}),s.addEvent(this._searchInput,"input",t=>{this._filter=s.getValue(t.currentTarget),this._getData()}),s.addEventDelegate(this._thead,"click","th",t=>{const e=s.index(t.currentTarget);this._columns[e].orderable&&(this._order=[[e,"asc"]],this._getData())}),s.addEventDelegate(this._pagination,"click","[data-page]",t=>{s.getDataset(t.currentTarget,"page")})}}),Object.assign(n.prototype,{_getDataInit(){this._getData=t=>{let s=this._data;if(this._filter){const t=e.escapeRegExp(this._filter),i=new RegExp(t,"i"),n=this._filter.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=e.escapeRegExp(n),r=new RegExp(a,"i");s=s.filter(t=>{for(const[e,s]of this._columns.entries())if(s.searchable&&(i.test(t[e])||r.test(t[e])))return!0;return!1})}s=s.sort((t,e)=>{for(const[s,i]of this._order){const n=t[s].toLowerCase(),a=e[s].toLowerCase(),r=n.localeCompare(a);if(r)return"desc"===i.toLowerCase()&&(r*=-1),r}return 0}),this._renderResults({filtered:s.length,results:s.slice(this._offset,this._offset+this._limit),total:this._data.length})}},_getResultsInit(){this._getData=t=>{this._request&&this._request.cancel&&(this._request.cancel(),this._request=null);const e=this._getResults({filter:this._filter,offset:this._offset,limit:this._limit,order:this._order});e.then(t=>{this._renderResults(t)}).catch(t=>{}).finally(t=>{this._request===e&&(this._request=null)})}},_getResultsCallbackInit(){this._getResults=t=>{const e=this._settings.getResults(t);return this._request=Promise.resolve(e),this._request.then(t=>(this._data=t.results,t)),this._request}}}),Object.assign(n.prototype,{_render(){s.empty(this._node),this._container=s.create("div",{class:"mb-1"}),s.before(this._node,this._container);const t=s.create("div",{class:"d-sm-flex justify-content-between mb-2"});this._preCol1=s.create("div"),s.append(t,this._preCol1),this._preCol2=s.create("div"),s.append(t,this._preCol2),this._thead=s.create("thead"),s.append(this._node,this._thead),this._tbody=s.create("tbody"),s.append(this._node,this._tbody);const e=s.create("div",{class:"d-sm-flex justify-content-between"});this._postCol1=s.create("div"),s.append(e,this._postCol1),this._postCol2=s.create("div"),s.append(e,this._postCol2),this._renderSearch(),this._renderLengthSelect(),s.append(this._container,t),s.append(this._container,this._node),s.append(this._container,e)},_renderHeadings(){s.empty(this._thead);const t=s.create("tr");for(const[e,i]of this._headings.entries()){const n=s.create("th");s.append(t,n);const a=s.create("div",{class:"d-flex justify-content-between"});s.append(n,a);const r=s.create("div",{class:"fw-bold",html:i});if(s.append(a,r),!this._columns[e].orderable)continue;s.setStyle(n,"cursor","pointer");let o="icon-sort";for(const t of this._order)t[0]==e&&(o="asc"==t[1]?"icon-sort-asc":"icon-sort-desc");const l=s.create("span",{class:o+" align-self-center"});s.append(a,l)}s.append(this._thead,t)},_renderInfo(t){s.empty(this._postCol1);const e=s.create("div",{class:"text-center text-sm-start mb-1 mb-sm-0"}),i=this._offset+1,n=this._offset+t.results.length,a=s.create("small",{text:`Showing results ${i} to ${n} of ${t.filtered}.`});s.append(e,a),s.append(this._postCol1,e)},_renderLengthSelect(){const t=s.create("div",{class:"d-flex justify-content-center justify-content-sm-start"}),e=s.create("label",{class:"mb-1 mb-sm-0"});s.append(t,e);const i=s.create("small",{class:"me-1",text:"Show"});s.append(e,i);const n=s.create("div",{class:"form-input d-inline-block",style:{width:"initial"}});s.append(e,n),this._lengthSelect=s.create("select",{class:"input-filled input-sm"}),s.append(n,this._lengthSelect);for(const t of this._settings.lengths){const e=s.create("option",{value:t,text:t});t==this._length&&s.setAttribute(e,"checked",!0),s.append(this._lengthSelect,e)}const a=s.create("div",{class:"ripple-line"});s.append(n,a);const r=s.create("small",{class:"ms-1",text:"results"});s.append(e,r),s.append(this._preCol1,t)},_renderPageItem(t){const e=s.create("div",{class:"page-item"}),i=s.create("a",{class:"page-link ripple"});if(s.append(e,i),t.disabled&&(s.addClass(e,"disabled"),s.setAttribute(i,"aria-disabled","true"),s.setAttribute(i,"tabindex","-1")),t.active&&s.addClass(e,"active"),t.icon){const e=s.create("span",{class:t.icon});s.append(i,e)}else s.setText(i,t.page);return e},_renderPagination(t){const e=Math.ceil(t.filtered/this._limit),i=1+this._offset/this._limit;s.empty(this._postCol2);const n=s.create("div",{class:"d-flex"});this._pagination=s.create("div",{class:"pagination pagination-sm mx-auto me-sm-0"}),s.append(n,this._pagination);const a=this._renderPageItem({icon:"icon-arrow-left",disabled:1==i});s.append(this._pagination,a);let r=Math.max(i-5,1),o=Math.min(i+5,e);for(;o-r>5;)r++,o--;for(let t=r;t<=o;t++){const e=this._renderPageItem({page:t,active:t==i});s.append(this._pagination,e)}const l=this._renderPageItem({icon:"icon-arrow-right",disabled:i==e});s.append(this._pagination,l),s.append(this._postCol2,n)},_renderResults(t){s.empty(this._tbody),this._renderHeadings(),this._renderPagination(t),this._renderInfo(t);for(const e of t.results){const t=this._renderRow(e);s.append(this._tbody,t)}},_renderRow(t,e,i){const n=s.create("tr");for(const[e,i]of this._columns.entries()){const a=t[i.key||e],r=s.create("td",{html:a});s.append(n,r)}return n},_renderSearch(){const t=s.create("div",{class:"form-input mx-auto me-sm-0",style:{width:"200px"}});this._searchInput=s.create("input",{class:"input-filled input-sm",attributes:{type:"text",placeholder:"Search"}}),s.append(t,this._searchInput);const e=s.create("div",{class:"ripple-line"});s.append(t,e),s.append(this._preCol2,t)}}),Object.assign(n,{_getDataFromDOM(t){const e=s.findOne("tbody",t);return s.children(e,"tr").map(t=>s.children(t,"td").map(t=>s.getHTML(t)))},_getHeadingsFromDOM(t){const e=s.findOne("thead",t),i=s.children(e,"tr").shift();return s.children(i,"th").map(t=>s.getHTML(t))}}),n.defaults={info:!0,lengthChange:!0,ordering:!0,paging:!0,searching:!0,length:10,lengths:[10,25,50,100],order:[[0,"asc"]],columns:null},i.initComponent("table",n),i.Table=n}));