!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-Tables requires a Window.");if(!("UI"in t))throw new Error("FrostUI-Tables requires FrostUI.");const e=t.Core,s=t.dom,i=(t.QuerySet,t.UI);t.document;class n extends i.BaseComponent{constructor(t,s){let i;super(t,s),this._data=[],this._getData=null,this._getResults=null,e.isFunction(this._settings.getResults)?(this._getResultsCallbackInit(),this._getResultsInit()):i=e.isArray(this._settings.data)?this._settings.data:this.constructor._getDataFromDOM(this._node),i&&(this._data=i,this._getDataInit()),this._headings=this.constructor._getHeadingsFromDOM(this._node),this._columns=[],this._settings.columns?this._columns=this._settings.columns:this._columns=new Array(this._headings.length).fill(),this._columns=this._columns.map((t,e)=>({class:null,dir:"asc",format:null,key:e,orderData:null,orderable:!0,searchable:!0,visible:!0,...t})),this._columnCount=this._columns.reduce((t,e)=>(e.visible&&t++,t),0),this._offset=0,this._limit=this._settings.length,this._order=this._settings.order.slice(),this._term=null,this._buildIndex(),this._render(),this._events(),this._getData()}destroy(){s.before(this._container,this._node),s.remove(this._container),s.empty(this._node);for(const t of s.children(this._original))s.append(this._node,t);super.destroy()}info(){return{end:this._offset+this._limit,filtered:this._filtered,start:this._offset,total:this._total}}length(t){return this._settings.paging&&(this._limit=t,s.triggerEvent(this._node,"length.ui.table"),this._getData()),this}loading(t=!0){return t?(s.triggerEvent(this._node,"processing.ui.table"),s.show(this._loader)):(s.hide(this._loader),s.triggerEvent(this._node,"processed.ui.table")),this}order(t){return this._settings.ordering&&(this._order=t,s.triggerEvent(this._node,"order.ui.table"),this._getData()),this}page(t){return this._settings.paging&&(this._offset=(t-1)*this._limit,s.triggerEvent(this._node,"page.ui.table"),this._getData()),this}refresh(){return this._renderResults(),this}reload(t=!1){return t&&(this._offset=0),this._getData(),this}search(t){return this._settings.searching&&(s.setValue(this._searchInput,t),this._term=t,s.triggerEvent(this._node,"search.ui.table"),this._getData()),this}}Object.assign(n.prototype,{addRow(t){return this._data.push(t),this._getResults&&this._rowIndexes.push(this._data.length-1),this._buildIndex(),this},getColumn(t){return this._data.map(s=>e.getDot(s,t))},getRow(t){return this._data[t]},getValue(t,s){return e.getDot(this._data[t],s)},hideColumn(t){return this._columns[t].visible=!1,this},removeRow(t){return this._data=this._data.filter((e,s)=>s!==t),this._buildIndex(),this},setColumn(t,s){return this._data=this._data.map((i,n)=>(e.setDot(i,t,s[n]),i)),this._buildIndex(),this},setRow(t,e){return this._data[t]=e,this._buildIndex(),this},setValue(t,s,i){return e.setDot(this._data[t],s,i),this._buildIndex(),this},showColumn(t){return this._columns[t].visible=!0,this}}),Object.assign(n.prototype,{_events(){if(this._settings.lengthChange&&s.addEvent(this._lengthSelect,"change.ui.table",t=>{const e=s.getValue(t.currentTarget);this.length(e)}),this._settings.searching){const t=e.debounce(t=>{console.log(t),this.search(t)},this._settings.debounceInput);s.addEvent(this._searchInput,"input.ui.table",e=>{const i=s.getValue(e.currentTarget);t(i)})}this._settings.ordering&&s.addEventDelegate(this._thead,"click.ui.table","th",t=>{t.preventDefault();const e=s.index(t.currentTarget);if(!this._columns[e].orderable)return;const i=this._columns[e].dir;let n=null;for(const[t,s]of this._order)if(t==e){n=s;break}let a,r=i;n===i&&(r="asc"===i?"desc":"asc"),a=t.shiftKey?n?n===i?this._order.map(([t,s])=>(t==e&&(s=r),[t,s])):this._order.filter(([t])=>t!=e):[...this._order,[e,r]]:[[e,r]],this.order(a)}),this._settings.paging&&s.addEventDelegate(this._pagination,"click.ui.table","[data-page]",t=>{t.preventDefault();const e=s.getDataset(t.currentTarget,"page");this.page(e)})}}),Object.assign(n.prototype,{_buildIndex(){if(!this._getResults&&this._settings.ordering){this._index=[];for(const t of this._columns){if(!t.orderable)return!1;this._index[t.key]=[];const s={};for(const[e,i]of this._data.entries()){const n=i[t.key];n in s||(s[n]=[]),s[n].push(e)}const i=Object.keys(s).sort((t,s)=>{if(e.isNumeric(t)&&e.isNumeric(s))return t-s;const i=t.toLowerCase(),n=s.toLowerCase();return i.localeCompare(n)});for(const e of i)this._index[t.key].push(s[e])}}},_getOrder(){const t=[];for(const[e,s]of this._order)this._columns[e].orderData?t.push(...this._columns[e.orderData]):t.push([e,s]);return t},_getOrderedIndexes(t,e=null,s=this._offset,i=this._limit,n=0){const[a,r]=t[n],o=this._columns[a].key;let h=this._index[o];"desc"===r&&(h=h.slice().reverse());let l=0;const c=[];for(const a of h){let o=e?a.filter(t=>e.includes(t)):a;if("desc"===r&&(o=o.slice().reverse()),s>l+o.length||!o.length){l+=a.length;continue}const h=o.length>1&&n<t.length-1?this._getOrderedIndexes(t,o,0,Math.min(o.length,i-c.length),n+1):a;for(const t of h)if(l++,!(l<s)&&(c.push(t),c.length==i))return c}return c}}),Object.assign(n.prototype,{_getDataInit(){this._total=this._data.length,this._getData=t=>{if(this.loading(),this._rowIndexes=null,this._term){this._rowIndexes=[];const t=e.escapeRegExp(this._term),s=new RegExp(t,"i"),i=this._term.normalize("NFD").replace(/[\u0300-\u036f]/g,""),n=e.escapeRegExp(i),a=new RegExp(n,"i");for(const[t,e]of this._data.entries())for(const i of this._columns)i.searchable&&(s.test(e[i.key])||a.test(e[i.key]))&&this._rowIndexes.push(t);this._filtered=this._rowIndexes.length}else this._filtered=this._total;if(this._settings.ordering){const t=this._getOrder();this._rowIndexes=this._getOrderedIndexes(t,this._rowIndexes)}this._results=[],this._rowIndexes||(this._rowIndexes=e.range(this._offset,this._offset+this._limit));for(const t of this._rowIndexes)this._results.push(this._data[t]);this._renderResults(),this.loading(!1)}},_getResultsInit(){this._getData=t=>{this._request&&this._request.cancel&&(this._request.cancel(),this._request=null);const s={};this._term&&(s.term=this._term),this._settings.ordering&&(s.order=this._order),this._settings.paging&&(s.offset=this._offset,s.limit=this._limit),this.loading();const i=this._getResults(s);i.then(t=>{this._request===i&&(this._total=t.total,this._filtered=t.filtered,this._data=this._results=t.results,this._rowIndexes=e.range(0,this._results.length-1),this._renderResults())}).catch(t=>{}).finally(t=>{this.loading(!1),this._request===i&&(this._request=null)})}},_getResultsCallbackInit(){this._getResults=t=>{const e=this._settings.getResults(t);return this._request=Promise.resolve(e),this._request.then(t=>(this._data=t.results,t)),this._request}}}),Object.assign(n.prototype,{_render(){this._original=s.clone(this._node),s.empty(this._node),this._container=s.create("div",{class:this.constructor.classes.container}),this._loader=s.create("div",{class:this.constructor.classes.loader});const t=s.create("span",{class:this.constructor.classes.loaderIcon});s.append(this._loader,t),s.addClass(this._node,this.constructor.classes.table),this._thead=s.create("thead"),s.append(this._node,this._thead),this._tbody=s.create("tbody"),s.append(this._node,this._tbody),s.findOne("tfoot",this._original)&&(this._tfoot=s.create("tfoot"),s.append(this._node,this._tfoot)),s.hide(this._loader),s.after(this._node,this._container),s.append(this._container,this._loader),this._settings.layout.top&&this._renderLayoutRow(this._settings.layout.top,this.constructor.classes.topRow),s.append(this._container,this._node),this._settings.layout.bottom&&this._renderLayoutRow(this._settings.layout.bottom,this.constructor.classes.bottomRow)},_renderHeadings(){s.empty(this._thead);const t=s.create("tr");for(const[e,i]of this._headings.entries()){if(!this._columns[e].visible)continue;const n=s.create("th",{class:this.constructor.classes.tableHeading,html:i.text});if(i.class&&s.addClass(n,i.class),s.append(t,n),!this._settings.ordering||!this._columns[e].orderable)continue;const a=[this.constructor.classes.tableSort];for(const t of this._order)t[0]==e&&("asc"==t[1]?a.push(this.constructor.classes.tableSortAsc):a.push(this.constructor.classes.tableSortDesc));s.addClass(n,a)}s.append(this._thead,t)},_renderInfo(){s.empty(this._infoContainer);const t=this._offset+1,e=this._offset+this._results.length;let i=this._total<this._filtered?this._settings.lang.infoFiltered:this._settings.lang.info;const n={start:t,end:e,filtered:this._filtered,total:this._total};for(const[t,e]of Object.entries(n))i=i.replace(`{${t}}`,e);this._settings.infoCallback&&(i=this._settings.infoCallback(t,e,this._total,this._filtered,a));const a=s.create("small",{text:i});s.append(this._infoContainer,a)},_renderInfoContainer(t){this._infoContainer=s.create("div",{class:this.constructor.classes.infoContainer}),s.append(t,this._infoContainer)},_renderLayoutRow(t,e){const i=s.create("div",{class:e});for(const e of t){const t=s.create("div",{class:this.constructor.classes.column});switch(e){case"search":this._renderSearch(t);break;case"length":this._renderLengthSelect(t);break;case"info":this._renderInfoContainer(t);break;case"pagination":this._renderPaginationContainer(t)}s.append(i,t)}s.append(this._container,i)},_renderLengthSelect(t){if(!this._settings.lengthChange)return;const e=s.create("div",{class:this.constructor.classes.lengthContainer}),i=s.create("label",{class:this.constructor.classes.lengthLabel});s.append(e,i);const n=s.create("small",{class:this.constructor.classes.lengthLabelText,text:this._settings.lang.perPage});s.append(i,n);const a=s.create("div",{class:this.constructor.classes.lengthInputContainer,style:{width:"initial"}});s.append(i,a),this._lengthSelect=s.create("select",{class:this.constructor.classes.lengthInput}),s.append(a,this._lengthSelect);for(const t of this._settings.lengths){const e=s.create("option",{value:t,text:t});t==this._limit&&s.setAttribute(e,"checked",!0),s.append(this._lengthSelect,e)}const r=s.create("div",{class:this.constructor.classes.lengthInputRipple});s.append(a,r),s.append(t,e)},_renderPageItem(t){const e=s.create("div",{class:this.constructor.classes.pageItem}),i=s.create("button",{html:t.text||t.page,class:this.constructor.classes.pageLink,attributes:{type:"button"}});return s.append(e,i),t.disabled&&(s.addClass(e,this.constructor.classes.pageDisabled),s.setAttribute(i,"aria-disabled","true"),s.setAttribute(i,"tabindex","-1")),t.active&&s.addClass(e,this.constructor.classes.pageActive),t.page&&s.setDataset(i,"page",t.page),e},_renderPagination(){const t=Math.ceil(this._filtered/this._limit),e=1+this._offset/this._limit;s.empty(this._pagination);const i=this._renderPageItem({text:this._settings.lang.paginate.first,disabled:1==e,page:1});s.append(this._pagination,i);const n=this._renderPageItem({text:this._settings.lang.paginate.previous,disabled:1==e,page:e>1?e-1:null});s.append(this._pagination,n);let a=Math.max(e-5,1),r=Math.min(e+5,t);for(;r-a>4;)e-a>r-e?a++:r--;for(let t=a;t<=r;t++){const i=this._renderPageItem({page:t,active:t==e});s.append(this._pagination,i)}const o=this._renderPageItem({text:this._settings.lang.paginate.next,disabled:e==t,page:e<t?e+1:null});s.append(this._pagination,o);const h=this._renderPageItem({text:this._settings.lang.paginate.last,disabled:e==t,page:t});s.append(this._pagination,h)},_renderPaginationContainer(t){const e=s.create("div",{class:this.constructor.classes.paginationContainer});s.append(t,e),this._pagination=s.create("div",{class:this.constructor.classes.pagination}),s.append(e,this._pagination)},_renderResults(){if(s.triggerEvent(this._node,"preDraw.ui.table"),s.empty(this._tbody),this._renderHeadings(),this._settings.headerCallback&&this._settings.headerCallback(this._head,this._data,this._offset,this._offset+this._limit,this._rowIndexes),this._settings.paging&&this._renderPagination(),this._settings.info&&this._renderInfo(),this._results.length)for(const[t,e]of this._results.entries()){const i=this._renderRow(e);this._settings.rowCallback&&this._settings.rowCallback(i,e,t,this._offset+t,this._rowIndexes[t]),s.append(this._tbody,i),this._settings.createdRow&&this._settings.createdRow(i,e,t)}else{const t=s.create("tr"),e=s.create("td",{class:this.constructor.classes.emptyCell,html:this._term?this._settings.lang.noResults:this._settings.lang.noData,attributes:{colspan:this._columnCount}});s.append(t,e),s.append(this._tbody,t)}this._settings.drawCallback&&this._settings.drawCallback(),this._tfoot&&this._settings.footerCallback&&this._settings.footerCallback(this._tfoot,this._data,this._offset,this._offset+this._limit,this._rowIndexes),s.triggerEvent(this._node,"draw.ui.table")},_renderRow(t){const e=s.create("tr");for(const i of this._columns){if(!i.visible)continue;const n=t[i.key],a=s.create("td",{html:i.format?i.format(n):n});i.class&&s.addClass(i.class),s.append(e,a)}return e},_renderSearch(t){if(!this._settings.searching)return;const e=s.create("div",{class:this.constructor.classes.searchContainer}),i=s.create("div",{class:this.constructor.classes.searchInputContainer,style:{width:"200px"}});s.append(e,i),this._searchInput=s.create("input",{class:this.constructor.classes.searchInput,attributes:{type:"text",placeholder:this._settings.lang.search}}),s.append(i,this._searchInput);const n=s.create("div",{class:this.constructor.classes.searchInputRipple});s.append(i,n),s.append(t,e)}}),Object.assign(n,{_getDataFromDOM(t){const e=s.findOne("tbody",t);return s.children(e,"tr").map(t=>s.children(t,"td").map(t=>s.getHTML(t)))},_getHeadingsFromDOM(t){const e=s.findOne("thead",t),i=s.children(e,"tr").shift();return s.children(i,"th").map(t=>({text:s.getHTML(t),class:s.getAttribute(t,"class")}))}}),n.defaults={layout:{top:["search","length"],bottom:["info","pagination"]},lang:{info:"Showing results {start} to {end} of {total}",infoFiltered:"Showing results {start} to {end} of {filtered} (filtered from {total} total)",noData:"No data available",noResults:"No results to show",perPage:"Per Page",search:"Search",paginate:{first:"First",last:"Last",next:"Next",previous:"Previous"}},createdRow:null,drawCallback:null,footerCallback:null,headerCallback:null,infoCallback:null,preDrawCallback:null,rowCallback:null,columns:null,order:[[0,"asc"]],lengths:[10,25,50,100],length:10,debounceInput:250,info:!0,lengthChange:!0,ordering:!0,paging:!0,searching:!0},n.classes={bottomRow:"d-md-flex justify-content-between",column:"d-flex",container:"position-relative mb-2",emptyCell:"text-center py-3",infoContainer:"text-center text-md-start mb-2 mb-md-0 w-100",lengthContainer:"d-flex justify-content-center justify-content-md-start w-100 mb-1",lengthInput:"input-filled input-sm",lengthInputContainer:"form-input d-inline-block",lengthInputRipple:"ripple-line",lengthLabel:"mb-1 mb-md-0",lengthLabelText:"me-2",loader:"position-absolute top-50 start-50 translate-middle",loaderIcon:"spinner-border text-primary",pageActive:"active",pageDisabled:"disabled",pageItem:"page-item",pageLink:"page-link ripple",pagination:"pagination pagination-sm mx-auto me-md-0",paginationContainer:"d-flex w-100",searchContainer:"w-100 mb-1",searchInput:"input-filled input-sm",searchInputContainer:"form-input mx-auto me-md-0",searchInputRipple:"ripple-line",table:"table table-bordered",tableHeading:"fw-bold",tableSort:"table-sort",tableSortAsc:"table-sort-asc",tableSortDesc:"table-sort-desc",topRow:"d-md-flex justify-content-between mb-2"},i.initComponent("table",n),i.Table=n}));